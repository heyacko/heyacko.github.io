<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>What Every Pokemon Game Would Cost Today</title>

  <!-- Reuse the global stylesheet -->
  <link rel="stylesheet" href="../../style.css" />

  <!-- D3.js for visualization -->
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <!-- Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    /* Breadcrumb Navigation */
    nav a:hover {
      color: var(--primary) !important;
    }

    /* Guess Section Styles */
    #guess-container {
      background: var(--white-alpha-80);
      backdrop-filter: blur(22px);
      border-radius: 20px;
      border: 1px solid var(--white-alpha-30);
      padding: 40px;
      margin: 40px 0;
      box-shadow: 0 8px 32px var(--shadow-color);
    }

    #guess-warning {
      text-align: center;
      color: var(--warning);
      font-size: 14px;
      margin: 20px 0;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    #submit-guess {
      display: block;
      margin: 30px auto;
      padding: 12px 30px;
      background: var(--white-alpha-80);
      color: var(--text-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 100px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #submit-guess:hover:not(:disabled) {
      background: var(--white-alpha-90);
      border-color: var(--neutral);
      transform: translateY(-2px);
    }

    #submit-guess:disabled {
      background: var(--neutral);
      cursor: not-allowed;
      opacity: 0.5;
    }

    #skip-all {
      padding: 15px 40px;
      background: var(--secondary);
      color: white;
      border: none;
      border-radius: 100px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 16px var(--secondary-alpha-30);
    }

    #skip-all:hover {
      background: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--primary-alpha-40);
    }

    #guess-summary {
      display: none;
      text-align: center;
      padding: 30px;
      margin: 30px 0;
      background: var(--primary-alpha-10);
      border-radius: 12px;
      font-size: 16px;
      line-height: 1.6;
    }

    #continue-reading {
      display: none;
      text-align: center;
      margin: 30px 0;
    }

    #continue-reading button {
      padding: 12px 30px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 100px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #continue-reading button:hover {
      background: var(--secondary);
      transform: translateY(-2px);
    }

    /* Comparison Section */
    #comparison-container,
    #console-container {
      background: var(--white-alpha-80);
      backdrop-filter: blur(22px);
      border-radius: 20px;
      border: 1px solid var(--white-alpha-30);
      padding: 40px;
      margin: 40px 0;
      box-shadow: 0 8px 32px var(--shadow-color);
    }

    /* Scrollytelling layout */
    /* Scrollytelling layout */
    .scrolly-container {
      position: relative;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      margin: 60px 0;
      min-height: 400vh; /* Allows for scroll progression */
    }

    .scrolly-narrative {
      position: relative;
    }

    .scrolly-step {
      min-height: 60vh;
      margin-bottom: 40vh;
      padding: 30px;
      background: var(--white-alpha-80);
      backdrop-filter: blur(22px);
      border-radius: 20px;
      border: 1px solid var(--white-alpha-30);
      opacity: 0.3;
      transition: opacity 0.4s ease;
    }

    .scrolly-step.active {
      opacity: 1;
    }

    .scrolly-step h2 {
      color: var(--primary);
      margin-top: 0;
    }

    .scrolly-viz {
      position: sticky;
      top: 100px;
      height: 80vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #chart-container {
      width: 100%;
      height: 100%;
      background: var(--white-alpha-80);
      backdrop-filter: blur(22px);
      border-radius: 20px;
      border: 1px solid var(--white-alpha-30);
      padding: 30px;
      box-shadow: 0 8px 32px var(--shadow-color);
    }

    /* Chart styles */
    .bar-original {
      fill: var(--primary-alpha-40);
      transition: fill 0.3s ease;
    }

    .bar-adjusted {
      fill: var(--secondary);
      transition: fill 0.3s ease;
    }

    .bar-original:hover,
    .bar-adjusted:hover {
      opacity: 0.8;
    }

    .axis-label {
      font-size: 12px;
      fill: var(--text-secondary);
    }

    .axis path,
    .axis line {
      stroke: var(--border-subtle);
    }

    .grid line {
      stroke: var(--border-subtle);
      stroke-opacity: 0.3;
      stroke-dasharray: 2,2;
    }

    .game-label {
      font-size: 14px;
      fill: var(--text-primary);
      font-weight: 500;
    }

    .chart-legend {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 20px;
      font-size: 14px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .legend-color {
      width: 20px;
      height: 12px;
      border-radius: 2px;
    }

    /* Mobile responsive */
    @media (max-width: 968px) {
      .scrolly-container {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .scrolly-viz {
        position: relative;
        top: 0;
        height: 60vh;
        margin-bottom: 40px;
      }

      .scrolly-step {
        min-height: auto;
        margin-bottom: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Breadcrumb Navigation -->
  <nav style="position: sticky; top: 0; background: var(--primary-light); backdrop-filter: blur(18px); border-bottom: 1px solid var(--border-subtle); z-index: 1000; padding: 15px 0;">
    <div style="max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; align-items: center; gap: 4px; font-family: 'Lucida Console', Monaco, 'Courier New', monospace; font-size: 1.5rem; font-weight: 700; color: var(--primary-dark);">
      <a href="../../index.html" style="color: inherit; text-decoration: none; transition: color 0.2s;">acko.cool</a>
      <span>/</span>
      <a href="../index.html" style="color: inherit; text-decoration: none; transition: color 0.2s;">blog</a>
      <span>/</span>
      <a href="./index.html" style="color: inherit; text-decoration: none; transition: color 0.2s;">pokemon-cost</a>
    </div>
  </nav>

  <main class="shared-wrap" style="margin-top: 40px;">
    <div id="article-header" class="shared-card prose" style="text-align: center; padding-bottom: 0;">
      <!-- Metadata and hero image will be inserted here -->
    </div>
    
    <article id="intro-content" class="shared-card prose">
      <noscript>Please enable JavaScript to view this article.</noscript>
    </article>

    <!-- Interactive Guessing Section -->
    <div id="guess-container">
      <svg id="guess-chart"></svg>
      <div id="skip-all-container" style="display: none; text-align: center; margin: 20px 0;">
        <button id="skip-all" class="skip-btn">View All Games</button>
      </div>
      <button id="submit-guess">Submit Guess</button>
      <div id="guess-summary"></div>
      <div id="continue-reading">
        <button onclick="document.getElementById('reveal-section').scrollIntoView({ behavior: 'smooth' })">
          Continue Reading â†’
        </button>
      </div>
    </div>

    <!-- Reveal Section -->
    <article id="reveal-section" class="shared-card prose">
      <!-- Reveal content will be inserted here -->
    </article>

    <!-- Comparison Section -->
    <div id="comparison-container">
      <svg id="comparison-chart"></svg>
    </div>

    <!-- Context Section -->
    <article id="context-section" class="shared-card prose">
      <!-- Context content will be inserted here -->
    </article>

    <!-- Console Chart Section -->
    <div id="console-container">
      <svg id="console-chart"></svg>
    </div>

    <!-- Conclusion Section -->
    <article id="conclusion-section" class="shared-card prose">
      <!-- Conclusion will be inserted here -->
    </article>
  </main>

  <script type="module">
    import { createGuessChart, submitGuess, guessAnother, skipToEnd, resizeGuessChart } from './guess.js';
    import { createComparisonChart, resizeComparisonChart } from './comparison-chart.js';
    import { createConsoleChart, resizeConsoleChart } from './console-chart.js';

    async function loadContent() {
      const res = await fetch('./content.md');
      let md = await res.text();
      
      // Extract YAML frontmatter
      const frontmatterMatch = md.match(/^---\s*\n([\s\S]*?)\n---\s*\n/);
      let metadata = { title: '', subtitle: '', author: '', date: '' };
      
      if (frontmatterMatch) {
        const frontmatter = frontmatterMatch[1];
        const titleMatch = frontmatter.match(/title:\s*(.+)/);
        const subtitleMatch = frontmatter.match(/subtitle:\s*(.+)/);
        const authorMatch = frontmatter.match(/author:\s*(.+)/);
        const dateMatch = frontmatter.match(/date:\s*(.+)/);
        
        if (titleMatch) metadata.title = titleMatch[1].trim();
        if (subtitleMatch) metadata.subtitle = subtitleMatch[1].trim();
        if (authorMatch) metadata.author = authorMatch[1].trim();
        if (dateMatch) metadata.date = dateMatch[1].trim();
      }
      
      // Display metadata in header card
      const headerEl = document.getElementById('article-header');
      headerEl.innerHTML = `
        <h1 class="shared-h1" style="margin-bottom: 10px;">${metadata.title}</h1>
        ${metadata.subtitle ? `<p class="shared-sub" style="font-size: 1.1em; color: var(--neutral); margin-bottom: 20px;">${metadata.subtitle}</p>` : ''}
        <div style="display: flex; gap: 20px; justify-content: center; align-items: center; color: var(--neutral); font-size: 0.9em; margin-bottom: 30px;">
          ${metadata.author ? `<span>By ${metadata.author}</span>` : ''}
          ${metadata.date ? `<span>${metadata.date}</span>` : ''}
        </div>
        <div style="margin: 0 -40px -40px -40px; overflow: hidden; aspect-ratio: 21/9;">
          <img src="img/hero.jpg" alt="Pokemon game collection" 
               style="width: 100%; height: 100%; object-fit: cover; display: block;" />
        </div>
      `;
      
      // Strip YAML frontmatter from content
      md = md.replace(/^---\s*\n[\s\S]*?\n---\s*\n/, '');
      
      // Split content by sections
      const sections = md.split('## ');
      const intro = sections[0];
      const reveal = sections[1] || '';
      const comparison = sections[2] || '';
      const console = sections[3] || '';
      const conclusion = sections[4] || '';
      
      // Parse and display sections
      const introHtml = marked.parse(intro, { mangle: false, headerIds: true });
      document.getElementById('intro-content').innerHTML = introHtml;
      
      const revealHtml = marked.parse('## ' + reveal, { mangle: false, headerIds: true });
      document.getElementById('reveal-section').innerHTML = revealHtml;
      
      const comparisonHtml = marked.parse('## ' + comparison, { mangle: false, headerIds: true });
      document.getElementById('context-section').innerHTML = comparisonHtml;
      
      const consoleHtml = marked.parse('## ' + console, { mangle: false, headerIds: true });
      document.getElementById('console-container').insertAdjacentHTML('beforebegin', 
        `<article class="shared-card prose">${consoleHtml}</article>`);
      
      const conclusionHtml = marked.parse('## ' + conclusion, { mangle: false, headerIds: true });
      document.getElementById('conclusion-section').innerHTML = conclusionHtml;
      
      // Load data and initialize visualizations
      const data = await fetch('./data.json').then(r => r.json());
      
      // Create guess chart
      createGuessChart(data);
      
      // Set up button event handlers
      document.getElementById('submit-guess').addEventListener('click', submitGuess);
      document.getElementById('skip-all').addEventListener('click', skipToEnd);
      
      // Create comparison and console charts
      await createComparisonChart();
      createConsoleChart();
      
      // Handle window resize
      window.addEventListener('resize', () => {
        resizeGuessChart();
        resizeComparisonChart();
        resizeConsoleChart();
      });
    }

    loadContent().catch(err => {
      document.getElementById('intro-content').innerHTML = `<p style="color:red">Error loading content.md</p><pre>${err}</pre>`;
      console.error(err);
    });
  </script>
</body>
</html>

