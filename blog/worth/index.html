<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Are Video Games Worth The Money?</title>

  <!-- Reuse the global stylesheet -->
  <link rel="stylesheet" href="../../style.css" />

  <!-- Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <main class="shared-wrap">
    <div id="article-header" class="shared-card prose" style="text-align: center;">
      <!-- Metadata will be inserted here -->
    </div>
    
    <article id="content" class="shared-card prose">
      <noscript>Please enable JavaScript to view this article.</noscript>
    </article>
  </main>

  <script type="module">
    import { processShortcodes } from './components/shortcodes.js';

    async function loadContent() {
      const res = await fetch('./content.md');
      let md = await res.text();
      
      // Extract YAML frontmatter
      const frontmatterMatch = md.match(/^---\s*\n([\s\S]*?)\n---\s*\n/);
      let metadata = { title: '', subtitle: '', author: '', date: '' };
      
      if (frontmatterMatch) {
        const frontmatter = frontmatterMatch[1];
        const titleMatch = frontmatter.match(/title:\s*(.+)/);
        const subtitleMatch = frontmatter.match(/subtitle:\s*(.+)/);
        const authorMatch = frontmatter.match(/author:\s*(.+)/);
        const dateMatch = frontmatter.match(/date:\s*(.+)/);
        
        if (titleMatch) metadata.title = titleMatch[1].trim();
        if (subtitleMatch) metadata.subtitle = subtitleMatch[1].trim();
        if (authorMatch) metadata.author = authorMatch[1].trim();
        if (dateMatch) metadata.date = dateMatch[1].trim();
      }
      
      // Display metadata in header card
      const headerEl = document.getElementById('article-header');
      headerEl.innerHTML = `
        <h1 class="shared-h1" style="margin-bottom: 10px;">${metadata.title}</h1>
        ${metadata.subtitle ? `<p class="shared-sub" style="font-size: 1.1em; color: var(--neutral); margin-bottom: 20px;">${metadata.subtitle}</p>` : ''}
        <div style="display: flex; gap: 20px; justify-content: center; align-items: center; color: var(--neutral); font-size: 0.9em;">
          ${metadata.author ? `<span>By ${metadata.author}</span>` : ''}
          ${metadata.date ? `<span>${metadata.date}</span>` : ''}
        </div>
      `;
      
      // Strip YAML frontmatter from content
      md = md.replace(/^---\s*\n[\s\S]*?\n---\s*\n/, '');
      
      // Process shortcodes BEFORE markdown parsing
      md = processShortcodes(md);
      
      // Parse markdown to HTML
      const html = marked.parse(md, { mangle: false, headerIds: true });
      document.getElementById('content').innerHTML = html;
    }

    loadContent().catch(err => {
      document.getElementById('content').innerHTML = `<p style="color:red">Error loading content.md</p><pre>${err}</pre>`;
    });
  </script>
</body>
</html>

