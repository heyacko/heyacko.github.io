<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Modern U.S. Politics Compass ‚Äî Randomized Quiz</title>
<link rel="stylesheet" href="style.css">
<style>
  /* 
  ================================================================================
  POLITICAL COMPASS QUIZ - PAGE-SPECIFIC STYLES
  ================================================================================
  This quiz measures political views on four axes:
  1. Collective vs Individual
  2. Institutional Trust vs Anti-Institutional  
  3. Cosmopolitan vs Localist
  4. Flux vs Order
  
  Most styling is handled by the shared stylesheet (style.css), but this page
  can have its own custom styles if needed for specific elements.
  
  CURRENT STATUS: All styles have been consolidated into the shared stylesheet
  for consistency across the site. This section is kept for future customizations.
  */
</style>
</head>
<body>
<div class="shared-wrap">
  <div class="shared-card">
    <h1 class="shared-h1">Modern U.S. Politics Compass</h1>
    <p class="shared-sub">
      Four axes: <span class="shared-pill">Collective ‚Üî Individual</span>
      <span class="shared-pill">Institutional Trust ‚Üî Anti-Institutional</span>
      <span class="shared-pill">Cosmopolitan ‚Üî Localist</span>
      <span class="shared-pill">Flux ‚Üî Order</span>
      <br><span class="shared-muted">Each visit samples 5 of 10 per axis (20 total) and shuffles the order.</span>
    </p>

    <!-- Progress -->
    <div class="shared-progress" role="progressbar" aria-valuemin="0" aria-valuemax="20" aria-valuenow="0">
      <span id="pbar"></span>
    </div>
    <div class="shared-meta"><span id="pcounter">Question 1 of 20</span><span id="axisHint" class="shared-muted"></span></div>

    <!-- Question area -->
    <div id="stage" class="shared-qbox" aria-live="polite"></div>

    <!-- Controls -->
    <div class="shared-controls">
      <button id="backBtn" class="shared-btn-ghost" type="button" disabled>Back</button>
      <button id="nextBtn" class="shared-btn" type="button" disabled>Next</button>
      <button id="clearBtn" class="shared-btn-ghost" type="button">Restart</button>
      <a href="index.html" class="shared-btn-ghost">üè† Home</a>
    </div>

    <!-- Results -->
    <div id="results" class="shared-results">
      <h2>Your Results</h2>
      <p class="shared-muted">Scores range from ‚àí10 to +10 per axis (0 = neutral). Positive leans toward the left label; negative toward the right.</p>
      <div id="axisTable" class="shared-row" style="flex-direction:column;margin-top:12px;"></div>

      <h3 style="margin-top:22px;">Likely Cluster</h3>
      <p><strong id="clusterName"></strong></p>
      <p class="shared-muted" id="clusterDesc"></p>

      <div class="shared-footer">Directional, not definitive. Share with friends and compare.</div>
    </div>
  </div>
</div>

<script>
/* 
================================================================================
POLITICAL COMPASS QUIZ - MAIN CONFIGURATION
================================================================================
This quiz presents 20 questions (5 per axis) to measure political views on four dimensions.

SCORING SYSTEM:
- A = strongly toward LEFT label of the axis (+2 points)
- B = somewhat toward LEFT (+1 point)  
- C = somewhat toward RIGHT (-1 point)
- D = strongly toward RIGHT (-2 points)

FOUR AXES MEASURED:
1. Collective ‚Üî Individual (community vs personal responsibility)
2. Institutional Trust ‚Üî Anti-Institutional (trust in systems vs skepticism)
3. Cosmopolitan ‚Üî Localist (global vs local focus)
4. Flux ‚Üî Order (change vs stability)

Each visit randomly selects 5 questions per axis (20 total) and shuffles the order.
*/
const AXES = [
  { key:'collective', left:'Collective', right:'Individual' },
  { key:'trust',      left:'Institutional Trust', right:'Anti-Institutional' },
  { key:'cosmo',      left:'Cosmopolitan', right:'Localist' },
  { key:'flux',       left:'Flux', right:'Order' },
];

const BANK = {
  collective: [
    { text:'A town‚Äôs bridge collapses. Who should rebuild it?',
      opts:['Government fully funds it','Town + company split cost','Local volunteers pitch in','Whoever needs it most pays'] },
    { text:'A company dumps trash in a river. What‚Äôs fair?',
      opts:['Government fines & cleans','Public pressure/boycott','Locals organize cleanups','Market punishes them'] },
    { text:'Taxes are like:',
      opts:['Dues to a club I believe in','Rent for public services','A fee I put up with','Money taken even if I quit'] },
    { text:'During a pandemic, who should call the shots?',
      opts:['National experts','Local mayors','Doctors/clinics','Each person decides'] },
    { text:'Fairness at work means:',
      opts:['Everyone earning about the same','Everyone getting a fair shot','Keeping what you earn','No rules‚Äîjust hustle'] },
    { text:'Homelessness in a city is like:',
      opts:['A shared problem‚Äîfund big programs','A city+business partnership issue','Neighborhood charity can handle it','An individual life-choice issue'] },
    { text:'Student debt should be handled by:',
      opts:['Government relief programs','Income-based public systems','Private scholarships/charities','Borrowers alone'] },
    { text:'Building new transit (subway/bus lanes) should be:',
      opts:['Publicly funded core service','Public with private help','Community-led micro-solutions','Left to market demand'] },
    { text:'Childcare affordability is mainly:',
      opts:['A public service to fund','A cost to subsidize some','A community/charity task','A family‚Äôs responsibility'] },
    { text:'When disaster hits (wildfires/floods), response should be:',
      opts:['Federal agencies lead','State/local government lead','Neighborhood groups lead','Individuals fend for themselves'] },
  ],
  trust: [
    { text:'News outlets are like:',
      opts:['Mostly honest referee','Biased but necessary ref','Ref who plays favorites','Ref rigging the game'] },
    { text:'Universities today are like:',
      opts:['Labs making new tools','Old engines needing tune-ups','Echo chambers','Overpriced museums'] },
    { text:'Court rulings feel like:',
      opts:['Justice served','Usually fair but messy','Insider decisions','Theater pretending justice'] },
    { text:'Big Tech companies are:',
      opts:['Builders of the future','Too powerful but fixable','Corporate empires','Spy networks'] },
    { text:'If officials deny what you saw, you think:',
      opts:['I missed something','They‚Äôre partly right','They‚Äôre spinning it','They‚Äôre lying'] },
    { text:'Elections in the U.S. are mostly:',
      opts:['Legit with minor issues','Imperfect but trustworthy','Questionable in many places','Fundamentally rigged'] },
    { text:'Scientific consensus is:',
      opts:['Best guide we have','Useful but political sometimes','Often captured by interests','A tool to control narratives'] },
    { text:'The banking/finance system is:',
      opts:['Reliable infrastructure','Flawed, needs reforms','Manipulated by insiders','Designed to exploit people'] },
    { text:'Public schools are:',
      opts:['Vital institutions','Fixable with reforms','Broken by bureaucracy','Vehicles for propaganda'] },
    { text:'‚ÄúFact-checkers‚Äù are:',
      opts:['Helpful referees','Helpful but biased','Narrative enforcers','Political censors'] },
  ],
  cosmo: [
    { text:'New immigrants move in. First thought:',
      opts:['Cool‚Äîmore food options','Hope they fit in fine','Hope things don‚Äôt change much','Why can‚Äôt we slow this down?'] },
    { text:'National pride feels like:',
      opts:['Pride in what we share globally','Quiet appreciation','Loyalty to roots','Defending what‚Äôs ours'] },
    { text:'Global trade is like:',
      opts:['Rising tide lifting boats','Wave helping some, hurting others','Jobs shipped away','Giving up the steering wheel'] },
    { text:'Kid wants to marry very different background. You feel:',
      opts:['Delighted','Curious but cautious','Uneasy','Strongly opposed'] },
    { text:'Local traditions vs global trends:',
      opts:['Let them mix freely','Keep a balance','Protect old ways','Guard them fiercely'] },
    { text:'City builds dense housing for newcomers:',
      opts:['Great‚Äîmore neighbors/ideas','Okay‚Äîif planned well','Worried about culture/traffic','Prefer to keep things as-is'] },
    { text:'Foreign language signs in your neighborhood:',
      opts:['Love the diversity','Fine if translations too','Prefer mostly English','Not welcome'] },
    { text:'International agreements (trade/climate):',
      opts:['Essential teamwork','Useful but limited','Risk to workers here','Erode sovereignty'] },
    { text:'Refugee resettlement locally:',
      opts:['Yes‚Äîhappy to help','Yes‚Äîwith good support','Maybe‚Äîlimited numbers','Prefer not here'] },
    { text:'National identity is mainly:',
      opts:['Shared values across cultures','A story we update together','Shared heritage/blood','Fixed tradition to preserve'] },
  ],
  flux: [
    { text:'Gender & family roles are like:',
      opts:['Apps‚Äîalways updating','Tools‚Äîadjustable with limits','Furniture‚Äîmove rarely','Foundations‚Äîdon‚Äôt change'] },
    { text:'Protests that block traffic are:',
      opts:['Vital to get attention','Okay if peaceful','Annoying but legal','Wrong, period'] },
    { text:'Best classroom looks like:',
      opts:['Playground of ideas','Lively debate hall','Disciplined workshop','Moral training ground'] },
    { text:'Tech change is:',
      opts:['Exciting','Good but needs brakes','Too fast','Dangerous'] },
    { text:'When a law feels wrong, you should:',
      opts:['Follow conscience','Work to change it','Obey unless extreme','Always obey the law'] },
    { text:'Art that shocks people is:',
      opts:['Healthy for culture','Useful in small doses','Often attention-seeking','Corrosive to values'] },
    { text:'Dress codes at work are:',
      opts:['Let people express','Light guidelines','Standard uniforms','Strict rules'] },
    { text:'Drug policy should:',
      opts:['Legalize/regulate','Decriminalize most','Keep most illegal','Get tougher'] },
    { text:'Online speech rules should:',
      opts:['As open as possible','Light moderation','Firm rules for safety','Strict to prevent chaos'] },
    { text:'City nightlife hours:',
      opts:['24/7‚Äîcities evolve','Late but limited','End earlier for peace','Close early‚Äîorder first'] },
  ],
};

const CHOICE_VALUE = { A:+2, B:+1, C:-1, D:-2 };

const CLUSTERS = [
  { name:'Liberal Institutionalist',
    match:s=>s.collective>0&&s.trust>0&&s.cosmo>0&&s.flux>0,
    desc:'Pro-government problem-solving, trusts major institutions, globalist identity, comfortable with cultural change.' },
  { name:'Progressive Populist',
    match:s=>s.collective>0&&s.trust<0&&s.cosmo>0&&s.flux>0,
    desc:'Collective action with low trust in elites; globalist identity; prefers fast change from outside institutions.' },
  { name:'National Conservative',
    match:s=>s.collective>=0&&s.trust<0&&s.cosmo<0&&s.flux<0,
    desc:'Community/government for cohesion, distrust of current elites, localist identity, order/tradition oriented.' },
  { name:'Traditional Conservative',
    match:s=>s.collective<0&&s.trust>0&&s.cosmo<0&&s.flux<0,
    desc:'Markets first, trusts legacy institutions, localist identity, values stability and hierarchy.' },
  { name:'Tech Libertarian',
    match:s=>s.collective<0&&s.trust<0&&s.cosmo>0&&s.flux>0,
    desc:'Individuals/markets over state, distrusts gatekeepers, globally oriented, change-friendly.' },
  { name:'Politically Homeless Pragmatist',
    match:s=>Math.abs(s.collective)<=2&&Math.abs(s.trust)<=2&&Math.abs(s.cosmo)<=2&&Math.abs(s.flux)<=2,
    desc:'Moderate across axes; case-by-case views; not easily pigeonholed.' },
];

/* ========= UTILS ========= */
function rngInt(n){ // 0..n-1 using crypto if available
  if (window.crypto?.getRandomValues){
    const a = new Uint32Array(1); crypto.getRandomValues(a);
    return a[0] % n;
  }
  return Math.floor(Math.random()*n);
}

function shuffle(arr){
  for (let i=arr.length-1;i>0;i--){
    const j = rngInt(i+1);
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function sampleN(arr, n){
  const idxs = arr.map((_,i)=>i);
  shuffle(idxs);
  return idxs.slice(0,n).map(i=>arr[i]);
}

/* ========= BUILD RANDOMIZED QUIZ (5 PER AXIS, SHUFFLED) ========= */
function buildQuiz(){
  const picked = [];
  for (const ax of AXES){
    const chosen = sampleN(BANK[ax.key], 5).map(q => ({...q, axis: ax.key}));
    picked.push(...chosen);
  }
  shuffle(picked);
  return picked; // length 20
}

/* ========= STATE / ELEMENTS ========= */
let QUESTIONS = buildQuiz();           // 20 randomized items
let idx = 0;                           // 0..19
const answers = new Array(QUESTIONS.length).fill(null); // 'A'|'B'|'C'|'D'|null

const stage = document.getElementById('stage');
const pbar = document.getElementById('pbar');
const pcounter = document.getElementById('pcounter');
const axisHint = document.getElementById('axisHint');
const backBtn = document.getElementById('backBtn');
const nextBtn = document.getElementById('nextBtn');
const clearBtn = document.getElementById('clearBtn');
const resultsEl = document.getElementById('results');
const axisTable = document.getElementById('axisTable');
const clusterName = document.getElementById('clusterName');
const clusterDesc = document.getElementById('clusterDesc');

/* 
================================================================================
QUIZ RENDERING FUNCTION - DISPLAYS QUESTIONS AND PROGRESS
================================================================================
This function updates the quiz interface to show the current question, progress,
and answer options. It's called every time the user advances to a new question.
*/
function render() {
  const total = QUESTIONS.length;
  const human = idx+1;
  pbar.style.width = ((human-1)/total*100) + '%';
  document.querySelector('.shared-progress').setAttribute('aria-valuenow', human-1);
  pcounter.textContent = `Question ${human} of ${total}`;

  const q = QUESTIONS[idx];
  const axisObj = AXES.find(a=>a.key===q.axis);
  axisHint.textContent = `${axisObj.left} ‚Üî ${axisObj.right}`;

  stage.innerHTML = '';
  const qtext = document.createElement('div');
  qtext.className = 'shared-qtext';
  qtext.textContent = `${human}. ${q.text}`;
  stage.appendChild(qtext);

  const opts = document.createElement('div'); opts.className='shared-opts';
  q.opts.forEach((opt, j) => {
    const letter = String.fromCharCode(65 + j); // A-D
    const id = `q${idx}_${letter}`;
    const lab = document.createElement('label');
    lab.className = 'shared-opt';
    lab.setAttribute('for', id);
    lab.innerHTML = `<input type="radio" name="q${idx}" id="${id}" value="${letter}"> <span>${letter}) ${opt}</span>`;
    opts.appendChild(lab);
  });
  stage.appendChild(opts);

  if (answers[idx]) {
    const input = stage.querySelector(`input[value="${answers[idx]}"]`);
    if (input) input.checked = true;
  }

  backBtn.disabled = idx === 0;
  nextBtn.textContent = (idx === total-1) ? 'See Results' : 'Next';
  nextBtn.disabled = !answers[idx];

  stage.addEventListener('change', (e) => {
    if (e.target && e.target.type === 'radio') {
      answers[idx] = e.target.value;
      nextBtn.disabled = false;
    }
  });

  resultsEl.style.display = 'none';
}
render();

/* ========= NAV ========= */
backBtn.addEventListener('click', () => {
  if (idx>0) { idx--; render(); }
});
nextBtn.addEventListener('click', () => {
  if (!answers[idx]) return;
  if (idx < QUESTIONS.length-1) {
    idx++; render();
  } else {
    showResults();
  }
});
clearBtn.addEventListener('click', () => {
  // restart with a fresh randomized test
  QUESTIONS = buildQuiz();
  for (let i=0;i<answers.length;i++) answers[i]=null;
  idx = 0;
  render();
});

/* ========= SCORING & RESULTS ========= */
function computeScores(){
  const scores = { collective:0, trust:0, cosmo:0, flux:0 };
  for (let i=0;i<QUESTIONS.length;i++){
    const a = answers[i];
    if (!a) continue;
    const val = CHOICE_VALUE[a];
    const axis = QUESTIONS[i].axis;
    scores[axis] += val;
  }
  return scores;
}
function pctFromScore(score){ return Math.max(0, Math.min(100, 50 + score*5)); }
function barColor(score){ if (score>=5) return 'var(--ok)'; if (score<=-5) return 'var(--bad)'; return 'var(--warn)'; }

function showResults(){
  const scores = computeScores();
  pbar.style.width = '100%';
  document.querySelector('.shared-progress').setAttribute('aria-valuenow', QUESTIONS.length);

  axisTable.innerHTML = '';
  AXES.forEach(ax => {
    const row = document.createElement('div'); row.className='shared-axis-row';
    const label = document.createElement('div');
    label.innerHTML = `<strong>${ax.left}</strong> <span class="muted">‚Üî</span> <strong>${ax.right}</strong>`;
    const bar = document.createElement('div'); bar.className='shared-bar';
    const span = document.createElement('span');
    span.style.width = pctFromScore(scores[ax.key]) + '%';
    span.style.background = barColor(scores[ax.key]);
    bar.appendChild(span);
    const val = document.createElement('div'); val.className='shared-muted';
    val.textContent = (scores[ax.key] >= 0 ? '+' : '') + scores[ax.key];
    row.appendChild(label); row.appendChild(bar); row.appendChild(val);
    axisTable.appendChild(row);
  });

  let chosen = CLUSTERS.find(c=>c.match(scores));
  if (!chosen){
    const bits = `${scores.collective>=0?'C':'I'}${scores.trust>=0?'T':'D'}${scores.cosmo>=0?'G':'L'}${scores.flux>=0?'F':'O'}`;
    chosen = { name:'Mixed Profile ('+bits+')', desc:'You mix positions across tribes. Read the axis scores; the nuance is the point.' };
  }
  clusterName.textContent = chosen.name;
  clusterDesc.textContent = chosen.desc;

  resultsEl.style.display = 'block';
  resultsEl.scrollIntoView({behavior:'smooth', block:'start'});
}

/* ========= QUALITY OF LIFE ========= */
document.addEventListener('keydown', (e)=>{
  if (e.key==='ArrowLeft' && !backBtn.disabled) backBtn.click();
  if (e.key==='ArrowRight' && !nextBtn.disabled) nextBtn.click();
});
</script>
</body>
</html>
