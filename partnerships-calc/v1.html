<!doctype html>
<html lang="en">
<head>
  <meta name="robots" content="noindex, nofollow" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Transit Partnership Calculator v1.0</title>
  <meta name="description" content="Simulate a transit partnership program for transit card activations & reloads. Calculates payouts, budget burn, and scale/runway under a fixed budget." />
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Transit Partnership Calculator v1.0</h1>
      <p id="app-desc">Estimate per-retailer payouts, broker fees, and budget burn to size or time a given partnership card program.</p>
    </header>

    <!-- Tab Navigation -->
    <div class="tab-navigation" role="tablist" aria-label="Calculator sections">
      <button class="tab-button active" id="inputs-tab" role="tab" aria-selected="true" aria-controls="inputs-panel">
        <span class="tab-icon">🧮</span>
        <span class="tab-label">Calculator</span>
      </button>
      <button class="tab-button" id="outputs-tab" role="tab" aria-selected="false" aria-controls="outputs-panel">
        <span class="tab-icon">📊</span>
        <span class="tab-label">Results (Beta)</span>
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Inputs Tab -->
      <section id="inputs-panel" class="tab-panel active" role="tabpanel" aria-labelledby="inputs-tab">
        <div class="grid" role="region" aria-labelledby="inputs-header">
          <!-- LEFT: Inputs (schema-driven) -->
          <section class="panel" aria-describedby="app-desc">
            <h2 id="inputs-header">Inputs</h2>

            <!-- The entire inputs UI is rendered here by app.js/buildInputs using the schema -->
            <div id="inputs-mount"></div>

            <div class="row mt-10" role="group" aria-label="Utilities">
              <button class="btn" id="resetBtn" type="button">Reset to defaults</button>
              <button class="btn ghost" id="copyBtn" type="button">Copy snapshot (JSON)</button>
              <button class="btn ghost" id="shareBtn" type="button" title="Create a link with current inputs in the URL hash">Shareable link</button>
              <span id="utilMsg" class="help" role="status" aria-live="polite"></span>
            </div>
          </section>

          <!-- RIGHT: Outputs (sibling of inputs, not nested) -->
          <section class="panel" role="region" aria-labelledby="inputs-outputs-header">
            <h2 id="inputs-outputs-header">Outputs</h2>

            <div class="cards" aria-live="polite">
              <div class="card third">
                <div class="kpi">
                  <div>
                    <div class="muted">Total Profit</div>
                    <div id="inputs-kpi-total-profit" class="value mono">—</div>
                  </div>
                  <span class="tooltip" tabindex="0" data-tip="Total Revenue - Total Cost"></span>
                </div>
              </div>

              <div class="card third">
                <div class="kpi">
                  <div>
                    <div class="muted">Total Revenue</div>
                    <div id="inputs-kpi-total-revenue" class="value mono">—</div>
                  </div>
                  <span class="tooltip" tabindex="0" data-tip="Monthly revenue × target months (Mode A) or runway months (Mode B)"></span>
                </div>
              </div>

              <div class="card third">
                <div class="kpi">
                  <div>
                    <div class="muted">Total Cost</div>
                    <div id="inputs-kpi-cost" class="value mono">—</div>
                  </div>
                  <span class="tooltip" tabindex="0" data-tip="Total cost over target months (Mode A) or monthly burn × runway (Mode B)"></span>
                </div>
              </div>

              <div class="card full">
                <div class="kpi">
                  <div>
                    <div class="muted">Per-retailer monthly activity</div>
                    <table class="table mono" aria-label="Per-retailer monthly activity table">
                      <thead><tr><th>Metric</th><th>Value</th><th></th></tr></thead>
                      <tbody>
                        <tr>
                          <td>Estimated visitors / month</td>
                          <td id="inputs-ob-visitors">—</td>
                          <td><span class="tooltip" tabindex="0" aria-label="Formula info" data-tip="visitors = new_visitors + recurring_visitors"></span></td>
                        </tr>
                        <tr>
                          <td>Estimated riders / month</td>
                          <td id="inputs-ob-riders">—</td>
                          <td><span class="tooltip" tabindex="0" aria-label="Formula info" data-tip="riders = visitors × transit%"></span></td>
                        </tr>
                        <tr>
                          <td>Estimated transit transactions / month</td>
                          <td id="inputs-ob-transit-transactions">—</td>
                          <td><span class="tooltip" tabindex="0" aria-label="Formula info" data-tip="transit_transactions = riders × avg_transactions_per_visitor"></span></td>
                        </tr>
                        <tr>
                          <td>Estimated activations / month</td>
                          <td id="inputs-ob-activations">—</td>
                          <td><span class="tooltip" tabindex="0" aria-label="Formula info" data-tip="activations = new_visitors × transit% × activation_conversion"></span></td>
                        </tr>
                        <tr>
                          <td>Estimated reloads / month</td>
                          <td id="inputs-ob-reloads">—</td>
                          <td><span class="tooltip" tabindex="0" aria-label="Formula info" data-tip="reloads = recurring_visitors × transit% × reload_conversion"></span></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="card full">
                <div class="kpi">
                  <div>
                    <div class="muted">Per-retailer monthly payout (to retailer)</div>
                    <table class="table mono" aria-label="Per-retailer payout table">
                      <thead><tr><th>Component</th><th>USD</th><th></th></tr></thead>
                      <tbody>
                        <tr>
                          <td>From activation %</td>
                          <td id="inputs-ob-p-activation">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="activations × avg_initial_load × activation_commission%"></span></td>
                        </tr>
                        <tr>
                          <td>From reload %</td>
                          <td id="inputs-ob-p-reload">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="reloads × avg_reload_amount × reload_commission%"></span></td>
                        </tr>
                        <tr>
                          <td>From flat fees</td>
                          <td id="inputs-ob-p-flat">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="(activations + reloads) × flat_fee_per_tx"></span></td>
                        </tr>
                        <tr>
                          <td>From promotional bonus</td>
                          <td id="inputs-ob-p-bonus">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="activations × bonus_per_activation"></span></td>
                        </tr>
                        <tr>
                          <th>Base payout per retailer / month (without bonus)</th>
                          <th id="inputs-ob-p-base">—</th>
                          <th><span class="tooltip" tabindex="0" data-tip="sum of activation%, reload%, and flat fee payouts (no bonus)"></span></th>
                        </tr>
                        <tr>
                          <th>Total payout per retailer / month (with bonus)</th>
                          <th id="inputs-ob-p-total">—</th>
                          <th><span class="tooltip" tabindex="0" data-tip="base payout + promotional bonus"></span></th>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="card full">
                <div class="kpi">
                  <div>
                    <div class="muted">Revenue &amp; Profit</div>
                    <table class="table mono" aria-label="Revenue and profit table">
                      <thead><tr><th>Metric</th><th>Value</th><th></th></tr></thead>
                      <tbody>
                        <tr>
                          <td>Total transit-using visitors / month</td>
                          <td id="inputs-ob-transit-visitors">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="retailers × (new_visitors + recurring_visitors) × transit%"></span></td>
                        </tr>
                        <tr>
                          <td>Total transit spend / month</td>
                          <td id="inputs-ob-transit-spend">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="transit_visitors × avg_transactions × cost_per_transaction"></span></td>
                        </tr>
                        <tr>
                          <td>Monthly revenue</td>
                          <td id="inputs-ob-monthly-revenue">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="transit_spend × interchange_rate%"></span></td>
                        </tr>
                        <tr>
                          <td>Monthly profit</td>
                          <td id="inputs-ob-monthly-profit">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="revenue - monthly_burn"></span></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div class="card full">
                <div class="kpi">
                  <div>
                    <div class="muted">Program scale &amp; budget</div>
                    <table class="table mono" aria-label="Program scale and budget table">
                      <tbody>
                        <tr class="only-mode-A">
                          <td>Max retailers under budget (floored)</td>
                          <td id="inputs-ob-max-retailers">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="max_retailers = floor( budget ÷ [T × (per_retailers_payout + broker_fee × activations_per_retailer)] ) with optional cap"></span></td>
                        </tr>
                        <tr class="only-mode-B">
                          <td>Runway (months)</td>
                          <td id="inputs-ob-runway">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="runway = budget ÷ monthly_burn"></span></td>
                        </tr>
                        <tr>
                          <td>Estimated monthly burn</td>
                          <td id="inputs-ob-monthly-burn">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="monthly_burn = retailers × per_retailers_payout + broker_fee × total_activations_all_retailers"></span></td>
                        </tr>
                        <tr class="only-mode-A">
                          <td>Total cost over target months</td>
                          <td id="inputs-ob-total-cost">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="total_cost = retailers × T × (per_retailers_payout + broker_fee × activations_per_retailers)"></span></td>
                        </tr>
                        <tr class="only-mode-A">
                          <td>Remaining budget after target months</td>
                          <td id="inputs-ob-remaining">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="remaining = budget − total_cost"></span></td>
                        </tr>
                        <tr class="only-mode-B">
                          <td>Budget exhausted in ~</td>
                          <td id="inputs-ob-exhaust">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="approximate months until budget reaches zero at current burn"></span></td>
                        </tr>
                        <tr>
                          <td>Will it exceed budget?</td>
                          <td id="inputs-ob-exceed">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="Mode A: checks total_cost ≤ budget. Mode B: runway ≥ desired months (if any)."></span></td>
                        </tr>
                      </tbody>
                    </table>
                    <div id="inputs-mode-context" class="footer-note"></div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </section>

      <!-- Outputs Tab -->
      <section id="outputs-panel" class="tab-panel" role="tabpanel" aria-labelledby="outputs-tab">
        <div class="panel" role="region" aria-labelledby="outputs-header">
          <h2 id="outputs-header">Results</h2>

          <!-- Executive Summary -->
          <div class="card full executive-summary">
            <div class="summary-header">
              <h3>📊 Executive Summary</h3>
              <div class="summary-kpis">
                <div class="kpi-item budget">
                  <div class="kpi-icon">💰</div>
                  <div class="kpi-content">
                    <div class="kpi-label">Budget Sufficiency</div>
                    <div class="kpi-value" id="sum-budget-ok">—</div>
                  </div>
                </div>
                <div class="kpi-item profit">
                  <div class="kpi-icon">📈</div>
                  <div class="kpi-content">
                    <div class="kpi-label">Monthly Profit</div>
                    <div class="kpi-value" id="sum-profit">—</div>
                  </div>
                </div>
                <div class="kpi-item cost">
                  <div class="kpi-icon">💸</div>
                  <div class="kpi-content">
                    <div class="kpi-label">Cost</div>
                    <div class="kpi-value" id="sum-cost">—</div>
                  </div>
                </div>
                <div class="kpi-item revenue">
                  <div class="kpi-icon">💰</div>
                  <div class="kpi-content">
                    <div class="kpi-label">Revenue</div>
                    <div class="kpi-value" id="sum-revenue">—</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="mode-context-summary" id="mode-context-summary">—</div>
          </div>

          <!-- Key Performance Indicators -->
          <div class="section-header">
            <h3>📊 Key Performance Indicators</h3>
            <p class="section-description">Core metrics for partnership program evaluation</p>
          </div>
          
          <!-- KPI Cards Grid -->
          <div class="cards-grid">
            <div class="card third">
              <div class="kpi">
                <div>
                  <div class="muted">Estimated payout per retailer / month</div>
                  <div id="kpi-retailerPayout" class="value mono">—</div>
                </div>
                <span class="tooltip" tabindex="0" data-tip="per-retailers payout from % on loads + flat fees"></span>
              </div>
            </div>

            <div class="card third">
              <div class="kpi">
                <div>
                  <div class="muted">Total broker payout (one-time)</div>
                  <div id="kpi-brokerPayout" class="value mono">—</div>
                </div>
                <span class="tooltip" tabindex="0" data-tip="num_retailers × broker_fee (one-time at onboarding)"></span>
              </div>
            </div>

            <div class="card third">
              <div class="kpi">
                <div>
                  <div class="muted">Total monthly program payouts</div>
                  <div id="kpi-totalPayouts" class="value mono">—</div>
                </div>
                <span class="tooltip" tabindex="0" data-tip="(retailers × per-retailers payout) + broker payout"></span>
              </div>
            </div>
          </div>

          <!-- Detailed Analysis -->
          <div class="section-header">
            <h3>🔍 Detailed Analysis</h3>
            <p class="section-description">Comprehensive breakdown of program metrics and calculations</p>
          </div>
          
          <!-- Detailed Analysis Sub-Tabs -->
          <div class="sub-tab-container">
            <div class="sub-tab-navigation" role="tablist" aria-label="Detailed analysis sections">
              <button class="sub-tab-button active" id="activity-subtab" role="tab" aria-selected="true" aria-controls="activity-panel">
                <span class="sub-tab-icon">👥</span>
                <span class="sub-tab-label">Activity</span>
                <span class="sub-tab-kpi" id="activity-kpi">—</span>
              </button>
              <button class="sub-tab-button" id="payout-subtab" role="tab" aria-selected="false" aria-controls="payout-panel">
                <span class="sub-tab-icon">💰</span>
                <span class="sub-tab-label">Payout</span>
                <span class="sub-tab-kpi" id="payout-kpi">—</span>
              </button>
              <button class="sub-tab-button" id="revenue-subtab" role="tab" aria-selected="false" aria-controls="revenue-panel">
                <span class="sub-tab-icon">📈</span>
                <span class="sub-tab-label">Revenue</span>
                <span class="sub-tab-kpi" id="revenue-kpi">—</span>
              </button>
              <button class="sub-tab-button" id="scale-subtab" role="tab" aria-selected="false" aria-controls="scale-panel">
                <span class="sub-tab-icon">📊</span>
                <span class="sub-tab-label">Scale</span>
                <span class="sub-tab-kpi" id="scale-kpi">—</span>
              </button>
            </div>
            
            <div class="sub-tab-content">
              <!-- Activity Panel -->
              <div id="activity-panel" class="sub-tab-panel active" role="tabpanel" aria-labelledby="activity-subtab">
              <div class="card full">
                <div class="kpi">
                  <div>
                    <div class="muted">Per-retailer monthly activity</div>
                    <table class="table mono" aria-label="Per-retailer monthly activity table">
                      <thead><tr><th>Metric</th><th>Value</th><th></th></tr></thead>
                      <tbody>
                        <tr>
                          <td>Estimated visitors / month</td>
                          <td id="ob-visitors">—</td>
                          <td><span class="tooltip" tabindex="0" aria-label="Formula info" data-tip="visitors = new_visitors + recurring_visitors"></span></td>
                        </tr>
                        <tr>
                          <td>Estimated riders / month</td>
                          <td id="ob-riders">—</td>
                          <td><span class="tooltip" tabindex="0" aria-label="Formula info" data-tip="riders = visitors × transit%"></span></td>
                        </tr>
                        <tr>
                          <td>Estimated transit transactions / month</td>
                          <td id="ob-transit-transactions">—</td>
                          <td><span class="tooltip" tabindex="0" aria-label="Formula info" data-tip="transit_transactions = riders × avg_transactions_per_visitor"></span></td>
                        </tr>
                        <tr>
                          <td>Estimated activations / month</td>
                          <td id="ob-activations">—</td>
                          <td><span class="tooltip" tabindex="0" aria-label="Formula info" data-tip="activations = new_visitors × transit% × activation_conversion"></span></td>
                        </tr>
                        <tr>
                          <td>Estimated reloads / month</td>
                          <td id="ob-reloads">—</td>
                          <td><span class="tooltip" tabindex="0" aria-label="Formula info" data-tip="reloads = recurring_visitors × transit% × reload_conversion"></span></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="card-footer">Each retailer serves <span id="footer-visitors">—</span> visitors monthly, with <span id="footer-riders">—</span> using transit.</div>
              </div>
            </div>
              </div>

              <!-- Payout Panel -->
              <div id="payout-panel" class="sub-tab-panel" role="tabpanel" aria-labelledby="payout-subtab">
              <div class="card full">
                <div class="kpi">
                  <div>
                    <div class="muted">Per-retailer monthly payout (to retailer)</div>
                    <table class="table mono" aria-label="Per-retailer payout table">
                      <thead><tr><th>Component</th><th>USD</th><th></th></tr></thead>
                      <tbody>
                        <tr>
                          <td>From activation %</td>
                          <td id="ob-p-activation">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="activations × avg_initial_load × activation_commission%"></span></td>
                        </tr>
                        <tr>
                          <td>From reload %</td>
                          <td id="ob-p-reload">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="reloads × avg_reload_amount × reload_commission%"></span></td>
                        </tr>
                        <tr>
                          <td>From flat fees</td>
                          <td id="ob-p-flat">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="(activations + reloads) × flat_fee_per_tx"></span></td>
                        </tr>
                        <tr>
                          <td>From promotional bonus</td>
                          <td id="ob-p-bonus">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="activations × bonus_per_activation"></span></td>
                        </tr>
                        <tr>
                          <th>Base payout per retailer / month (without bonus)</th>
                          <th id="ob-p-base">—</th>
                          <th><span class="tooltip" tabindex="0" data-tip="sum of activation%, reload%, and flat fee payouts (no bonus)"></span></th>
                        </tr>
                        <tr>
                          <th>Total payout per retailer / month (with bonus)</th>
                          <th id="ob-p-total">—</th>
                          <th><span class="tooltip" tabindex="0" data-tip="base payout + promotional bonus"></span></th>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="card-footer">Each retailer earns <span id="footer-retailer-payout">—</span> monthly including the promotional activation bonus.</div>
              </div>
            </div>
              </div>

              <!-- Revenue Panel -->
              <div id="revenue-panel" class="sub-tab-panel" role="tabpanel" aria-labelledby="revenue-subtab">
                <div class="card full">
                <div class="kpi">
                  <div>
                    <div class="muted">Revenue &amp; Profit</div>
                    <table class="table mono" aria-label="Revenue and profit table">
                      <thead><tr><th>Metric</th><th>Value</th><th></th></tr></thead>
                      <tbody>
                        <tr>
                          <td>Total transit-using visitors / month</td>
                          <td id="ob-transit-visitors">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="retailers × (new_visitors + recurring_visitors) × transit%"></span></td>
                        </tr>
                        <tr>
                          <td>Total transit spend / month</td>
                          <td id="ob-transit-spend">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="transit_visitors × avg_transactions × cost_per_transaction"></span></td>
                        </tr>
                        <tr>
                          <td>Monthly revenue</td>
                          <td id="ob-monthly-revenue">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="transit_spend × interchange_rate%"></span></td>
                        </tr>
                        <tr>
                          <td>Monthly profit</td>
                          <td id="ob-monthly-profit">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="revenue - monthly_burn"></span></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="card-footer">Monthly profit of <span id="footer-profit">—</span> from <span id="footer-revenue">—</span> revenue.</div>
              </div>
            </div>
              </div>

              <!-- Scale Panel -->
              <div id="scale-panel" class="sub-tab-panel" role="tabpanel" aria-labelledby="scale-subtab">
                <div class="card full">
                <div class="kpi">
                  <div>
                    <div class="muted">Program scale &amp; budget</div>
                    <table class="table mono" aria-label="Program scale and budget table">
                      <tbody>
                        <tr class="only-mode-A">
                          <td>Max retailers under budget (floored)</td>
                          <td id="ob-max-retailers">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="max_retailers = floor( budget ÷ [T × (per_retailers_payout + broker_fee × activations_per_retailer)] ) with optional cap"></span></td>
                        </tr>
                        <tr class="only-mode-B">
                          <td>Runway (months)</td>
                          <td id="ob-runway">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="runway = budget ÷ monthly_burn"></span></td>
                        </tr>
                        <tr>
                          <td>Estimated monthly burn</td>
                          <td id="ob-monthly-burn">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="monthly_burn = retailers × per_retailers_payout + broker_fee × total_activations_all_retailers"></span></td>
                        </tr>
                        <tr class="only-mode-A">
                          <td>Total cost over target months</td>
                          <td id="ob-total-cost">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="total_cost = retailers × T × (per_retailers_payout + broker_fee × activations_per_retailers)"></span></td>
                        </tr>
                        <tr class="only-mode-A">
                          <td>Remaining budget after target months</td>
                          <td id="ob-remaining">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="remaining = budget − total_cost"></span></td>
                        </tr>
                        <tr class="only-mode-B">
                          <td>Budget exhausted in ~</td>
                          <td id="ob-exhaust">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="approximate months until budget reaches zero at current burn"></span></td>
                        </tr>
                        <tr>
                          <td>Will it exceed budget?</td>
                          <td id="ob-exceed">—</td>
                          <td><span class="tooltip" tabindex="0" data-tip="Mode A: checks total_cost ≤ budget. Mode B: runway ≥ desired months (if any)."></span></td>
                        </tr>
                      </tbody>
                    </table>
                    <div id="mode-context" class="footer-note"></div>
                  </div>
                </div>
                <div class="card-footer">Broker receives <span id="footer-broker">—</span> one-time at onboarding.</div>
              </div>
            </div>
              </div>
            </div>
          </div>

          <div class="card full assumptions" role="note" aria-label="Assumptions">
            <strong>Assumptions (v1 steady-state model):</strong>
            <ul>
              <li>Activations derive from <em>new</em> monthly foot traffic; reloads from <em>recurring</em> traffic.</li>
              <li>Newly activated riders are <em>not</em> added to recurring pools in future months (no cohorting).</li>
              <li>One broker handles all retailers; broker fee accrues on each activation as it happens.</li>
              <li>All percentages are entered as percents (e.g., 10 means 10%).</li>
              <li>All inputs are adjustable; defaults are placeholders.</li>
            </ul>
          </div>
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- app.js will import calc.js, build the inputs from a schema, and wire up interactions -->
  <script type="module" src="./app.js"></script>
</body>
</html>

