<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Transit Partnership Calculator v0.1</title>
  <meta name="description" content="Simulate a New York bodega partnership program for transit card activations & reloads. Calculates payouts, budget burn, and scale/runway under a fixed budget." />
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Bodega Transit Partnership Calculator</h1>
      <p id="app-desc">Estimate per-bodega payouts, broker fees, and budget burn to size or time a NYC bodega transit card program.</p>
    </header>

    <div class="grid" role="region" aria-labelledby="inputs-header">
      <!-- LEFT: Inputs (schema-driven) -->
      <section class="panel" aria-describedby="app-desc">
        <h2 id="inputs-header">Inputs</h2>

        <!-- The entire inputs UI is rendered here by app.js/buildInputs using the schema -->
        <div id="inputs-mount"></div>

        <div class="row mt-10" role="group" aria-label="Utilities">
          <button class="btn" id="resetBtn" type="button">Reset to defaults</button>
          <button class="btn ghost" id="copyBtn" type="button">Copy snapshot (JSON)</button>
          <button class="btn ghost" id="shareBtn" type="button" title="Create a link with current inputs in the URL hash">Shareable link</button>
          <span id="utilMsg" class="help" role="status" aria-live="polite"></span>
        </div>
      </section>

      <!-- RIGHT: Outputs (sibling of inputs, not nested) -->
      <section class="panel" role="region" aria-labelledby="outputs-header">
        <h2 id="outputs-header">Outputs</h2>

        <div class="cards" aria-live="polite">
          <div class="card full">
            <div class="kpi">
              <div>
                <div class="muted">Per-bodega monthly activity</div>
                <table class="table mono" aria-label="Per-bodega monthly activity table">
                  <thead><tr><th>Metric</th><th>Value</th><th></th></tr></thead>
                  <tbody>
                    <tr>
                      <td>Estimated activations / month</td>
                      <td id="ob-activations">—</td>
                      <td><span class="tooltip" tabindex="0" aria-label="Formula info" data-tip="activations = new_visitors × transit% × activation_conversion"></span></td>
                    </tr>
                    <tr>
                      <td>Estimated reloads / month</td>
                      <td id="ob-reloads">—</td>
                      <td><span class="tooltip" tabindex="0" aria-label="Formula info" data-tip="reloads = recurring_visitors × transit% × reload_conversion"></span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="card full">
            <div class="kpi">
              <div>
                <div class="muted">Per-bodega monthly payout (to bodega)</div>
                <table class="table mono" aria-label="Per-bodega payout table">
                  <thead><tr><th>Component</th><th>USD</th><th></th></tr></thead>
                  <tbody>
                    <tr>
                      <td>From activation %</td>
                      <td id="ob-p-activation">—</td>
                      <td><span class="tooltip" tabindex="0" data-tip="activations × avg_initial_load × activation_commission%"></span></td>
                    </tr>
                    <tr>
                      <td>From reload %</td>
                      <td id="ob-p-reload">—</td>
                      <td><span class="tooltip" tabindex="0" data-tip="reloads × avg_reload_amount × reload_commission%"></span></td>
                    </tr>
                    <tr>
                      <td>From flat fees</td>
                      <td id="ob-p-flat">—</td>
                      <td><span class="tooltip" tabindex="0" data-tip="(activations + reloads) × flat_fee_per_tx"></span></td>
                    </tr>
                    <tr>
                      <th>Total per-bodega payout / month</th>
                      <th id="ob-p-total">—</th>
                      <th><span class="tooltip" tabindex="0" data-tip="sum of activation%, reload%, and flat fee payouts"></span></th>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <div class="card third">
            <div class="kpi">
              <div>
                <div class="muted">Estimated payout per bodega / month</div>
                <div id="kpi-bodegaPayout" class="value mono">—</div>
              </div>
              <span class="tooltip" tabindex="0" data-tip="per-bodega payout from % on loads + flat fees"></span>
            </div>
          </div>

          <div class="card third">
            <div class="kpi">
              <div>
                <div class="muted">Estimated payout to broker / month</div>
                <div id="kpi-brokerPayout" class="value mono">—</div>
              </div>
              <span class="tooltip" tabindex="0" data-tip="total_activations_all_bodegas × broker_fee"></span>
            </div>
          </div>

          <div class="card third">
            <div class="kpi">
              <div>
                <div class="muted">Total monthly program payouts</div>
                <div id="kpi-totalPayouts" class="value mono">—</div>
              </div>
              <span class="tooltip" tabindex="0" data-tip="(bodegas × per-bodega payout) + broker payout"></span>
            </div>
          </div>

          <div class="card full">
            <div class="kpi">
              <div>
                <div class="muted">Program scale &amp; budget</div>
                <table class="table mono" aria-label="Program scale and budget table">
                  <tbody>
                    <tr class="only-mode-A">
                      <td>Max bodegas under budget (floored)</td>
                      <td id="ob-max-bodegas">—</td>
                      <td><span class="tooltip" tabindex="0" data-tip="max_bodegas = floor( budget ÷ [T × (per_bodega_payout + broker_fee × activations_per_bodega)] ) with optional cap"></span></td>
                    </tr>
                    <tr class="only-mode-B">
                      <td>Runway (months)</td>
                      <td id="ob-runway">—</td>
                      <td><span class="tooltip" tabindex="0" data-tip="runway = budget ÷ monthly_burn"></span></td>
                    </tr>
                    <tr>
                      <td>Estimated monthly burn</td>
                      <td id="ob-monthly-burn">—</td>
                      <td><span class="tooltip" tabindex="0" data-tip="monthly_burn = bodegas × per_bodega_payout + broker_fee × total_activations_all_bodegas"></span></td>
                    </tr>
                    <tr class="only-mode-A">
                      <td>Total cost over target months</td>
                      <td id="ob-total-cost">—</td>
                      <td><span class="tooltip" tabindex="0" data-tip="total_cost = bodegas × T × (per_bodega_payout + broker_fee × activations_per_bodega)"></span></td>
                    </tr>
                    <tr class="only-mode-A">
                      <td>Remaining budget after target months</td>
                      <td id="ob-remaining">—</td>
                      <td><span class="tooltip" tabindex="0" data-tip="remaining = budget − total_cost"></span></td>
                    </tr>
                    <tr class="only-mode-B">
                      <td>Budget exhausted in ~</td>
                      <td id="ob-exhaust">—</td>
                      <td><span class="tooltip" tabindex="0" data-tip="approximate months until budget reaches zero at current burn"></span></td>
                    </tr>
                    <tr>
                      <td>Will it exceed budget?</td>
                      <td id="ob-exceed">—</td>
                      <td><span class="tooltip" tabindex="0" data-tip="Mode A: checks total_cost ≤ budget. Mode B: runway ≥ desired months (if any)."></span></td>
                    </tr>
                  </tbody>
                </table>
                <div id="mode-context" class="footer-note"></div>
              </div>
            </div>
          </div>

          <div class="card full assumptions" role="note" aria-label="Assumptions">
            <strong>Assumptions (v1 steady-state model):</strong>
            <ul>
              <li>Activations derive from <em>new</em> monthly foot traffic; reloads from <em>recurring</em> traffic.</li>
              <li>Newly activated riders are <em>not</em> added to recurring pools in future months (no cohorting).</li>
              <li>One broker handles all bodegas; broker fee accrues on each activation as it happens.</li>
              <li>All percentages are entered as percents (e.g., 10 means 10%).</li>
              <li>All inputs are adjustable; defaults are placeholders.</li>
            </ul>
            <div class="footer-note">Future versions could add: cohorting, seasonality, multi-broker splits, per-borough parameters.</div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- app.js will import calc.js, build the inputs from a schema, and wire up interactions -->
  <script type="module" src="./app.js"></script>
</body>
</html>
